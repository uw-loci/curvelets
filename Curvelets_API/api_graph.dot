digraph CurveletsAPI {
  rankdir=TB;
  node [shape=box, style=rounded, fontsize=10];
  edge [fontsize=8];
  
  // Define ranks for clean alignment
  subgraph cluster_high {
    label="High-level User Interfaces";
    style=filled;
    fillcolor=lightblue;
    fontsize=12;
    
    // Main CurveAlign interfaces
    subgraph cluster_curvealign {
      label="CurveAlign Module";
      style=filled;
      fillcolor=lightcyan;
      CA[label="CurveAlign.m\n(Main GUI)"];
      CAroi[label="CAroi.m\n(ROI Analysis)"];
      CAcli[label="CurveAlign_CommandLine.m\n(CLI Interface)"];
      GUI1[label="CurveAlignVisualization.mlapp\n(Visualization GUI)"];
      ROIgui[label="ROIbasedDensityCalculation.mlapp\n(ROI Density GUI)"];
    }
    
    // CT-FIRE module
    subgraph cluster_ctfire {
      label="CT-FIRE Module";
      style=filled;
      fillcolor=lightgreen;
      CTFIRE[label="ctFIRE.m\n(Main CT-FIRE)"];
      CTFIREcluster[label="ctFIRE_cluster.m\n(Cluster Processing)"];
      CTFIREgui[label="roi_gui_v3.m\n(ROI GUI)"];
      CTFIREintersect[label="intersectionGUI.mlapp\n(Intersection Analysis)"];
      CTFIREprops[label="intersectionProperties.mlapp\n(Intersection Properties)"];
      CTFIREorch[label="goCTFK.m\n(CT-FIRE Orchestration)"];
    }
    
    // Cell analysis module
    subgraph cluster_cell {
      label="Cell Analysis Module";
      style=filled;
      fillcolor=lightyellow;
      CellGUI[label="Cellanalysis/*.mlapp\n(Cell Analysis GUIs)"];
      TumorAnnot[label="TumorRegionAnnotationGUI.mlapp\n(Tumor Annotation)"];
    }
    
    // ROI management module
    subgraph cluster_roi {
      label="ROI Management Module";
      style=filled;
      fillcolor=lightsteelblue;
      ROIman[label="ROI Definition\n(Manual/Automatic)"];
      ROItools[label="ROI Analysis Tools\n(Selection/Management)"];
    }
    
    // Preprocessing module
    subgraph cluster_prep {
      label="Preprocessing Module";
      style=filled;
      fillcolor=lightpink;
      PrepGUI[label="bioFormatsMatlabGUI.m\n(Bio-Formats Loader)"];
      ThreshGUI[label="autoThreshGUI.m\n(Auto Thresholding)"];
      PrepModule[label="preprocmodule.m\n(Main Preprocessing)"];
    }
  }

  subgraph cluster_mid {
    label="Mid-level Processing Pipelines";
    style=filled;
    fillcolor=lightgray;
    fontsize=12;
    
    // Image processing pipelines
    subgraph cluster_pipelines {
      label="Image Processing";
      style=filled;
      fillcolor=white;
      PImg[label="processImage.m\n(Main Pipeline)"];
      PROI[label="processROI.m\n(ROI Pipeline)"];
      PPar[label="processImage_p.m\n(Parallel Pipeline)"];
      PCK[label="processImageCK.m\n(CK Pipeline)"];
    }
    
    // Feature extraction
    subgraph cluster_features {
      label="Feature Extraction";
      style=filled;
      fillcolor=white;
      GetCT[label="getCT.m\n(Curvelet Features)"];
      GetCTroi[label="getCTroi.m\n(ROI Curvelet Features)"];
      GetFIRE[label="getFIRE.m\n(Load CT-FIRE Output)"];
    }
    
    // CT-FIRE processing pipelines
    subgraph cluster_ctfire_processing {
      label="CT-FIRE Processing";
      style=filled;
      fillcolor=lightgreen;
      CTFIREprocess[label="ctFIRE_1.m\n(Core CT-FIRE Processing)"];
      CTFIREprocessP[label="ctFIRE_1p.m\n(Parallel CT-FIRE)"];
      CTFIREfeatures[label="ctFeatures.m\n(CT-FIRE Feature Extraction)"];
      CTFIREcheck[label="checkCTFireFiles.m\n(CT-FIRE Validation)"];
    }
    
    // Analysis utilities
    subgraph cluster_analysis {
      label="Analysis Utilities";
      style=filled;
      fillcolor=white;
      GB[label="getBoundary.m\n(Polygon Boundary)"];
      GTB[label="getTifBoundary.m\n(TIFF Boundary)"];
      Stats[label="makeStatsO.m\n(Statistics)"];
      CheckFiles[label="checkCAoutput.m\n(Validation)"];
    }
    
    // Visualization utilities
    subgraph cluster_viz {
      label="Visualization Utilities";
      style=filled;
      fillcolor=white;
      DrawMap[label="drawMap.m\n(Angle Maps)"];
      DrawCurv[label="drawCurvs.m\n(Curvelet Drawing)"];
      DrawOverlay[label="draw_CAoverlay.m\n(Overlay Creation)"];
    }
  }

  subgraph cluster_low {
    label="Low-level Algorithms";
    style=filled;
    fillcolor=lightyellow;
    fontsize=12;
    
    // Curvelet algorithms
    subgraph cluster_curvelet_algs {
      label="Curvelet Algorithms";
      style=filled;
      fillcolor=white;
      NewCurv[label="newCurv.m\n(Curvelet Extraction)"];
      CTrec[label="CTrec.m\n(Reconstruction)"];
      CTrec1[label="CTrec_1.m\n(CT-FIRE Reconstruction)"];
    }
    
    // External libraries
    subgraph cluster_external {
      label="External Libraries";
      style=filled;
      fillcolor=white;
      FDCT[label="CurveLab FDCT\nfdct_wrapping\nifdct_wrapping\nfdct_wrapping_param", shape=ellipse, fillcolor=orange];
      FIRE[label="FIRE Algorithm\nIndividual Fiber\nExtraction", shape=ellipse, fillcolor=lightcoral];
    }
  }

  // ==========================================
  // MAIN WORKFLOW CONNECTIONS (Clean paths)
  // ==========================================
  
  // CurveAlign main workflow
  CA -> PImg [label="main analysis", color=blue, penwidth=2];
  CA -> PROI [label="ROI analysis", color=blue];
  CAcli -> PImg [label="CLI analysis", color=blue];
  CAroi -> PROI [label="ROI focus", color=blue];
  GUI1 -> PImg [label="visualization", color=blue];
  ROIgui -> PROI [label="ROI density", color=blue];
  
  // CT-FIRE workflow
  CTFIRE -> CTFIREprocess [label="main CT-FIRE", color=green, penwidth=2];
  CTFIREcluster -> CTFIREprocessP [label="cluster processing", color=green];
  CTFIREgui -> PROI [label="ROI analysis", color=green];
  CTFIREintersect -> CTFIREfeatures [label="intersection analysis", color=green];
  CTFIREprops -> CTFIREfeatures [label="properties analysis", color=green];
  CTFIREorch -> CTFIREprocess [label="orchestration", color=green];
  
  // Cell analysis workflow
  CellGUI -> PROI [label="cell-fiber analysis", color=gold];
  TumorAnnot -> PROI [label="tumor measurements", color=gold];
  
  // ROI management workflow
  ROIman -> PROI [label="ROI definition", color=steelblue];
  ROItools -> PROI [label="ROI analysis", color=steelblue];
  ROIgui -> ROItools [label="density tools", color=steelblue];
  
  // Preprocessing workflow
  PrepGUI -> PImg [label="image loading", color=purple];
  ThreshGUI -> PImg [label="thresholding", color=purple];
  PrepModule -> PImg [label="preprocessing", color=purple];
  
  // ==========================================
  // PROCESSING PIPELINE CONNECTIONS
  // ==========================================
  
  // Main processing pipelines to feature extraction
  PImg -> GetCT [label="curvelet path", color=blue];
  PImg -> GetFIRE [label="CT-FIRE path", color=green];
  PROI -> GetCTroi [label="ROI curvelets", color=blue];
  PROI -> GetFIRE [label="ROI CT-FIRE", color=green];
  PPar -> GetCT [label="parallel curvelets", color=blue];
  PPar -> GetFIRE [label="parallel CT-FIRE", color=green];
  PCK -> GetFIRE [label="CK CT-FIRE", color=green];
  
  // Processing to analysis utilities
  PImg -> GB [label="boundary analysis"];
  PImg -> GTB [label="TIFF boundary"];
  PImg -> Stats [label="statistics"];
  PROI -> GB [label="ROI boundary"];
  PROI -> Stats [label="ROI stats"];
  
  // Processing to visualization
  PImg -> DrawMap [label="angle maps"];
  PImg -> DrawCurv [label="overlays"];
  PROI -> DrawMap [label="ROI maps"];
  
  // CT-FIRE internal connections
  CTFIREprocess -> CTFIREfeatures [label="feature extraction", color=green];
  CTFIREprocessP -> CTFIREfeatures [label="parallel features", color=green];
  CTFIREprocess -> FIRE [label="fiber extraction", color=green];
  CTFIREprocessP -> FIRE [label="parallel fibers", color=green];
  CTFIREfeatures -> FDCT [label="curvelet enhancement", color=green];
  GetFIRE -> CTFIREcheck [label="validation", color=green];
  
  // ==========================================
  // LOW-LEVEL ALGORITHM CONNECTIONS
  // ==========================================
  
  // Curvelet extraction path
  GetCT -> NewCurv [label="extract curvelets", color=blue, penwidth=2];
  GetCTroi -> NewCurv [label="ROI curvelets", color=blue];
  
  // CT-FIRE extraction path
  GetFIRE -> CTFIREprocess [label="load CT-FIRE output", color=green, penwidth=2];
  GetFIRE -> CTFIREprocessP [label="load parallel output", color=green];
  
  // Core algorithms to external libraries
  NewCurv -> FDCT [label="FDCT transform", color=red, penwidth=2];
  CTrec -> FDCT [label="reconstruction", color=red];
  CTrec1 -> FDCT [label="CT-FIRE reconstruction", color=red];
}


